<sequence version="3.10">
  <referenceList>
    <reference package="OPC003BE" />
    <reference package="OPC00003" />
  </referenceList>
  <globalVarList>
    <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering">false</variable>
  </globalVarList>
  <group name="Build the Reference Machine" description="Actions to build a reference machine">
    <step type="SMS_TaskSequence_RebootAction" name="Restart in Windows PE" description="" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">equals</variable>
          <variable name="Value">false</variable>
          <variable name="Variable">_SMSTSInWinPE</variable>
        </expression>
      </condition>
      <action>smsboot.exe /target:WinPE</action>
      <defaultVarList>
        <variable name="SMSRebootMessage" property="Message">A new Microsoft Windows operating system is being installed.  The computer must reboot to continue.</variable>
        <variable name="SMSRebootTimeout" property="MessageTimeout">10</variable>
        <variable name="SMSRebootTarget" property="Target" hidden="true">WinPE</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_PartitionDiskAction" name="Partition Disk 0 - BIOS" description="This action partitions and formats the disk for new deployments of BIOS-based computers. This step will not run for Unified Extensible Firmware Interface (UEFI)-based computers." runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notExists</variable>
          <variable name="Variable">_SMSTSClientCache</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">OEMMedia</variable>
          <variable name="Variable">_SMSTSMediaType</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_OSDMigrateUseHardlinks</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_SMSTSBootUEFI</variable>
        </expression>
      </condition>
      <action>osddiskpart.exe</action>
      <defaultVarList>
        <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
        <variable name="OSDDiskType" property="DiskType">Basic</variable>
        <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
        <variable name="OSDGPTBootDisk" property="GPTBootDisk">false</variable>
        <variable name="OSDPartitionStyle" property="PartitionStyle">MBR</variable>
        <variable name="OSDPartitions" property="Partitions" hidden="true">1</variable>
        <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">true</variable>
        <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable>
        <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">NTFS</variable>
        <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
        <variable name="OSDPartitions0Size" property="Partitions0Size">100</variable>
        <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">Percent</variable>
        <variable name="OSDPartitions0Type" property="Partitions0Type">Primary</variable>
        <variable name="OSDPartitions0VolumeName" property="Partitions0VolumeName">Windows</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_PartitionDiskAction" name="Partition Disk 0 - UEFI" description="This action partitions and formats the disk for new deployments of Unified Extensible Firmware Interface (UEFI)-based computers. This step will not run for BIOS-based computers." runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notExists</variable>
          <variable name="Variable">_SMSTSClientCache</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">OEMMedia</variable>
          <variable name="Variable">_SMSTSMediaType</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_OSDMigrateUseHardlinks</variable>
        </expression>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">equals</variable>
          <variable name="Value">true</variable>
          <variable name="Variable">_SMSTSBootUEFI</variable>
        </expression>
      </condition>
      <action>osddiskpart.exe</action>
      <defaultVarList>
        <variable name="OSDDiskIndex" property="DiskIndex">0</variable>
        <variable name="OSDDiskType" property="DiskType">Basic</variable>
        <variable name="OSDDiskpartBiosCompatibilityMode" property="DiskpartBiosCompatibilityMode">false</variable>
        <variable name="OSDGPTBootDisk" property="GPTBootDisk">true</variable>
        <variable name="OSDPartitionStyle" property="PartitionStyle">GPT</variable>
        <variable name="OSDPartitions" property="Partitions" hidden="true">3</variable>
        <variable name="OSDPartitions0AssignVolumeLetter" property="Partitions0AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions0Bootable" property="Partitions0Bootable">false</variable>
        <variable name="OSDPartitions0FileSystem" property="Partitions0FileSystem">FAT32</variable>
        <variable name="OSDPartitions0QuickFormat" property="Partitions0QuickFormat">true</variable>
        <variable name="OSDPartitions0Size" property="Partitions0Size">500</variable>
        <variable name="OSDPartitions0SizeUnits" property="Partitions0SizeUnits">MB</variable>
        <variable name="OSDPartitions0Type" property="Partitions0Type">EFI</variable>
        <variable name="OSDPartitions1AssignVolumeLetter" property="Partitions1AssignVolumeLetter">false</variable>
        <variable name="OSDPartitions1Bootable" property="Partitions1Bootable">false</variable>
        <variable name="OSDPartitions1QuickFormat" property="Partitions1QuickFormat">false</variable>
        <variable name="OSDPartitions1Size" property="Partitions1Size">128</variable>
        <variable name="OSDPartitions1SizeUnits" property="Partitions1SizeUnits">MB</variable>
        <variable name="OSDPartitions1Type" property="Partitions1Type">MSR</variable>
        <variable name="OSDPartitions2AssignVolumeLetter" property="Partitions2AssignVolumeLetter">true</variable>
        <variable name="OSDPartitions2Bootable" property="Partitions2Bootable">true</variable>
        <variable name="OSDPartitions2FileSystem" property="Partitions2FileSystem">NTFS</variable>
        <variable name="OSDPartitions2QuickFormat" property="Partitions2QuickFormat">true</variable>
        <variable name="OSDPartitions2Size" property="Partitions2Size">100</variable>
        <variable name="OSDPartitions2SizeUnits" property="Partitions2SizeUnits">Percent</variable>
        <variable name="OSDPartitions2Type" property="Partitions2Type">Primary</variable>
        <variable name="OSDPartitions2VolumeName" property="Partitions2VolumeName">Windows</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyOperatingSystemAction" name="Apply Operating System" description="Actions to apply operating system" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>OSDApplyOS.exe /image:OPC003BE,%OSDImageIndex% /runfromnet:False</action>
      <defaultVarList>
        <variable name="OSDImageIndex" property="ImageIndex">1</variable>
        <variable name="ImagePackageID" property="ImagePackageID" hidden="true">OPC003BE</variable>
        <variable name="OSDInstallEditionIndex" property="InstallEditionIndex">0</variable>
        <variable name="RunFromNet" property="RunFromNet" hidden="true">false</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyWindowsSettingsAction" name="Apply Windows Settings" description="Actions to apply Windows settings" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdwinsettings.exe /config</action>
      <defaultVarList>
        <variable name="OSDLocalAdminPassword" property="AdminPassword"></variable>
        <variable name="OSDComputerName" property="ComputerName">%_SMSTSMachineName%</variable>
        <variable name="OSDProductKey" property="ProductKey"></variable>
        <variable name="OSDRandomAdminPassword" property="RandomAdminPassword">false</variable>
        <variable name="OSDRegisteredOrgName" property="RegisteredOrgName">HP Inc.</variable>
        <variable name="OSDRegisteredUserName" property="RegisteredUserName">Kiran Alli</variable>
        <variable name="OSDServerLicenseConnectionLimit" property="ServerLicenseConnectionLimit">5</variable>
        <variable name="OSDTimeZone" property="TimeZone">Pacific Standard Time</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_ApplyNetworkSettingsAction" name="Apply Network Settings" description="Actions to configure network settings" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdnetsettings.exe configure</action>
      <defaultVarList>
        <variable name="OSDDomainName" property="DomainName">redmond.corp.microsoft.com</variable>
        <variable name="OSDJoinPassword" property="DomainPassword"></variable>
        <variable name="OSDJoinAccount" property="DomainUsername">redmond\kialli</variable>
        <variable name="OSDEnableTCPIPFiltering" property="EnableTCPIPFiltering" hidden="true">false</variable>
        <variable name="OSDNetworkJoinType" property="NetworkJoinType">0</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_AutoApplyAction" name="Apply Device Drivers" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <condition>
        <expression type="SMS_TaskSequence_VariableConditionExpression">
          <variable name="Operator">notEquals</variable>
          <variable name="Value">FullMedia</variable>
          <variable name="Variable">_SMSTSMediaType</variable>
        </expression>
      </condition>
      <action>osddriverclient.exe /auto /bestmatch:%OSDAutoApplyDriverBestMatch% /unsigned:%OSDAllowUnsignedDriver%</action>
      <defaultVarList>
        <variable name="OSDAutoApplyDriverBestMatch" property="BestMatch">true</variable>
        <variable name="OSDAllowUnsignedDriver" property="UnsignedDriver">false</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_SetupWindowsAndSMSAction" name="Setup Windows and Configuration Manager" description="Actions to setup Windows and Configuration Manager client" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <action>OSDSetupWindows.exe</action>
      <defaultVarList>
        <variable name="SMSClientInstallProperties" property="ClientInstallProperties"></variable>
        <variable name="_SMSClientPackageID" property="ClientPackageID">OPC00003</variable>
      </defaultVarList>
    </step>
  </group>
  <group name="Capture the Reference Machine" description="Actions to prepare and capture the reference machine">
    <step type="SMS_TaskSequence_JoinDomainWorkgroupAction" name="Join Workgroup" description="" runIn="FullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdjoin.exe /type:%OSDJoinType%</action>
      <defaultVarList>
        <variable name="OSDJoinPassword" property="DomainPassword"></variable>
        <variable name="OSDJoinAccount" property="DomainUsername">redmond\kialli</variable>
        <variable name="OSDJoinSkipReboot" property="SkipReboot">false</variable>
        <variable name="OSDJoinType" property="Type">1</variable>
        <variable name="OSDJoinWorkgroupName" property="WorkgroupName">Workgroup</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_PrepareSMSClientAction" name="Prepare Configuration Manager Client" description="" runIn="FullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdpreparesmsclient.exe</action>
      <defaultVarList />
    </step>
    <step type="SMS_TaskSequence_PrepareOSAction" name="Prepare OS" description="" runIn="FullOS" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdprepareos.exe /activate:%OSDKeepActivation% /bmsd:%OSDBuildStorageDriverList% /shutdown:%OSDShutdownPreparedOs%</action>
      <defaultVarList>
        <variable name="OSDBuildStorageDriverList" property="BuildStorageDriverList">false</variable>
        <variable name="OSDKeepActivation" property="KeepActivation">false</variable>
        <variable name="OSDShutdownPreparedOs" property="ShutdownPreparedOs">false</variable>
      </defaultVarList>
    </step>
    <step type="SMS_TaskSequence_CaptureSystemImageAction" name="Capture the Reference Machine" description="" runIn="WinPE" successCodeList="0" retryCount="0" runFromNet="false">
      <action>osdcapturesystemimage.exe</action>
      <defaultVarList>
        <variable name="OSDCaptureDestination" property="CaptureDestination">\\scfs\teams\OSD\kialli\1.wim</variable>
        <variable name="OSDCaptureAccountPassword" property="CapturePassword"></variable>
        <variable name="OSDCaptureAccount" property="CaptureUsername">redmond\kialli</variable>
        <variable name="OSDImageCreator" property="ImageCreator">kialli</variable>
        <variable name="OSDImageDescription" property="ImageDescription"></variable>
        <variable name="OSDImageVersion" property="ImageVersion"></variable>
      </defaultVarList>
    </step>
  </group>
</sequence>